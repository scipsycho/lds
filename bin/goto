#!/bin/bash


if [[ -f "$LDS_GOTO_FILE" ]]
then 
  source "$LDS_GOTO_FILE" 
else
  touch "$LDS_GOTO_FILE"
  echo "#!/bin/bash"  > "$LDS_GOTO_FILE" 
  echo "" >> "$LDS_GOTO_FILE"
  chmod a+x "$LDS_GOTO_FILE"
fi 

function printHash {
  for i in `seq $1` 
  do
    echo -n "$2"
  done
  echo ""
}

function showHelpMenu {
  printHash 10 #
  echo "Usage: goto [OPTIONS] [DIR] ALIAS"
  echo "Options:"
  echo "-r, --register DIR ALIAS: create an alias ALIAS for the directory DIR"
}
if [[ $# -gt 3 ]] 
    then
        showHelpMenu
        return
    fi


isRegister=n
REGISTER_DIR=""
ALIAS=""
while [[ $# -gt 0 ]]
do 
  case $1 in 
    -r|--register)
      REGISTER_DIR="$2"
      isRegister="y"
      if ! [[ -d "$REGISTER_DIR" ]]
      then 
          echo "No such directory! See --help for more details."
        return
      fi 
      REGISTER_DIR=`cd $REGISTER_DIR; pwd`
      shift
      shift
      ;;
    clean)
      mv "$LDS_GOTO_FILE" "${LDS_GOTO_FILE}_backup"
      rm "$LDS_GOTO_FILE" > /dev/null 2>&1
      echo "Cleaned all aliases.."
      return
    ;;
  --help|-h|help)
      showHelpMenu 
      return 
    ;; 
  list|--list|-l)
    for i in `( set -o posix ; set ) | grep "^LDS_ALIAS_"`
    do
      alias_temp=`echo $i | awk -F "=" '{ print $1 }'`
      alias_dir_temp=`echo $i | awk -F "=" '{ print $2 }'`
		  echo "$(tput setaf 2)$alias_temp$(tput setaf 4): $(tput setaf 5)$alias_temp$(tput sgr0)"
    done
    return
    ;;
    *)
      ALIAS=$1
      if [[ "$ALIAS" == "" ]]
      then 
        showHelpMenu 
        return
      fi 
      shift
      ;;
  esac
done

if [[ "$isRegister" == "n" ]]
then
  ALIAS="LDS_ALIAS_$ALIAS"
  cd "${!ALIAS}"
elif [[ -d "$REGISTER_DIR" ]]
then 
  echo "LDS_ALIAS_$ALIAS=$REGISTER_DIR" >> "$LDS_GOTO_FILE"
  echo "Alias $ALIAS has been created for $REGISTER_DIR" 
fi



